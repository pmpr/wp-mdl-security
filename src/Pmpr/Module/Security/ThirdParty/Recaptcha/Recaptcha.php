<?php
/*   _______________________________________
    |  Obfuscated by PMPR - Php Obfuscator  |
    |             68a661c737a19             |
    |_______________________________________|
*/
 namespace Pmpr\Module\Security\ThirdParty\Recaptcha; use Exception; use Pmpr\Common\Foundation\Interfaces\Constants; use Pmpr\Module\Security\Container; use Pmpr\Module\Security\Tratis\RecaptchaTrait; use WP_Error; class Recaptcha extends Container { use RecaptchaTrait; const aaskskmcwakmsogi = 'g-recaptcha-response'; const agkkoeoygiqmweai = 'g-recaptcha-response-check'; public function wigskegsqequoeks() { $this->qcsmikeggeemccuu('init', [$this, 'init']); parent::wigskegsqequoeks(); } public function kgquecmsgcouyaya() { $this->aqaqisyssqeomwom('panel_scripts', [$this, 'oogsiaaykcyaiuse'])->aqaqisyssqeomwom('panel_inline_config', [$this, 'ikgewiaemwykmwoa']); if ($this->ockgcoyewecmsqag()) { $this->cecaguuoecmccuse('lmtttmpts_plugin_forms', [$this, 'oaeowaoiiyqagqoc']); $this->aqaqisyssqeomwom('verify_recaptcha', [$this, 'ussowkigumoaoowo'])->aqaqisyssqeomwom('is_recaptcha_verify_passed', [$this, 'memkcksqcswuuucs'])->aqaqisyssqeomwom('security_recaptcha_get_html', [$this, 'wgqqgewcmcemoewo'], 10, 2)->aqaqisyssqeomwom('recaptcha_limit_attempts_check', [$this, 'aowomwcucgqqciow'], 10, 2); } parent::kgquecmsgcouyaya(); } public function init() { if ($this->ockgcoyewecmsqag()) { $this->waqewsckuayqguos('before_enqueue_assets', [$this, 'enqueue'])->waqewsckuayqguos('security_recaptcha_render_html', [$this, 'owykscaeskyaywow']); if ($this->wmkggougegmmywqg(Setting::aqoquuuwysagakqo)) { $this->qcsmikeggeemccuu('login_form', [$this, 'ayakoceesasakkug'])->qcsmikeggeemccuu('authenticate', [$this, 'ykimweskqqucieug'], 21); if (!$this->uwkmaywceaaaigwo()->giiecckwoyiawoyy()->gsaomcwyacqcumaa()) { $this->qcsmikeggeemccuu('register_form', [$this, 'ayakoceesasakkug'], 99)->qcsmikeggeemccuu('registration_errors', [$this, 'msyeyoqmgswmkmqq']); } else { $this->qcsmikeggeemccuu('signup_blogform', [$this, 'aweogmegeigqoagk'])->qcsmikeggeemccuu('signup_extra_fields', [$this, 'aweogmegeigqoagk'])->cecaguuoecmccuse('wpmu_validate_user_signup', [$this, 'usqaeseikciwyyco']); } $this->qcsmikeggeemccuu('lostpassword_form', [$this, 'ayakoceesasakkug'])->qcsmikeggeemccuu('allow_password_reset', [$this, 'iaaimyouoqioysei'], 21); } if ($this->wmkggougegmmywqg(Constants::COMMENT)) { $this->qcsmikeggeemccuu('pre_comment_on_post', [$this, 'ygyuikekoaqceoao'])->qcsmikeggeemccuu('comment_form_after_fields', [$this, 'lgkgiiwswqkaiiwy'])->qcsmikeggeemccuu('comment_form_logged_in_after', [$this, 'lgkgiiwswqkaiiwy']); } } } public function oogsiaaykcyaiuse($mismekckwcmuksik) { if ($this->ockgcoyewecmsqag()) { $mismekckwcmuksik['recaptcha'] = $this->caokeucsksukesyo()->usugyumcgeaaowsi()->aqmcwcyggeiyooyg($this, 'recaptcha-module.js'); } return $mismekckwcmuksik; } public function ikgewiaemwykmwoa($uiewakwqscemywuo) { if ($this->ockgcoyewecmsqag()) { $uiewakwqscemywuo['recaptcha_sitekey'] = $this->weysguygiseoukqw(Setting::vagagcuyyeiqoikg); $uiewakwqscemywuo['recaptcha_version'] = $this->weysguygiseoukqw(Setting::auugqowqueaocgsu); } return $uiewakwqscemywuo; } public function enqueue($wuomgsuaoscwgsmq) { $meakksicouekcgoe = $this->caokeucsksukesyo()->usugyumcgeaaowsi(); if ($this->weysguygiseoukqw(Setting::souygsesuwemocka)) { $mqowgioskkceceig = $meakksicouekcgoe->awgyqswkqywwmkye($this, 'hide-recaptcha')->awagieqcmmwkgwgs('.grecaptcha-badge{visibility: hidden !important;}'); $meakksicouekcgoe->yawoscugkyysowie($mqowgioskkceceig)->wqiosiseiwsamggo($mqowgioskkceceig); } $kqagasmwymmuiksq = $this->aaiqmckgssqmwqyc(); $wqsyimmcqogaosaq = ['messages' => ['pass_recaptcha' => $kqagasmwymmuiksq === 'v3' ? __('for load Google reCAPTCHA fill the form inputs.', PR__MDL__SECURITY) : __('Please pass Google reCAPTCHA test.', PR__MDL__SECURITY), 'in_progress' => __('Please wait until Google reCAPTCHA is loaded.', PR__MDL__SECURITY), 'timeout' => __('Failed to load Google reCAPTCHA. Please check your internet connection and reload this page.', PR__MDL__SECURITY)], 'vars' => ['error' => sprintf('%s:&nbsp;%s', $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->ciuuiyckmsygceis(__('Warning', PR__MDL__SECURITY)), $this->iwcyqwuymeoesqem(self::ewiwasqsgesysueq)), 'visibility' => 'login_footer' === current_filter()], 'version' => $kqagasmwymmuiksq, 'sitekey' => $this->weysguygiseoukqw(Setting::vagagcuyyeiqoikg), 'disable' => $this->weysguygiseoukqw(Setting::hsksgyosmeowqeww, false), 'input' => Recaptcha::aaskskmcwakmsogi]; $kuoicyiuewoqyaqe = $meakksicouekcgoe->owygwqwawqoiusis($this, 'recaptcha', 'recaptcha.js')->okawmmwsiuauwsiu(); switch ($wuomgsuaoscwgsmq) { case Constants::iickqyckyaqcaokm: $meakksicouekcgoe->yawoscugkyysowie($kuoicyiuewoqyaqe)->qkqeooqcomucuwyk($this, 'recaptcha', $wqsyimmcqogaosaq); break; case Constants::yuguikokwoymmqem: $meakksicouekcgoe->wqiosiseiwsamggo($kuoicyiuewoqyaqe)->gauosiuwaieksway($this, 'recaptcha', $wqsyimmcqogaosaq); break; } } public function ayakoceesasakkug() { $kqagasmwymmuiksq = $this->aaiqmckgssqmwqyc(); $qeswwaqqsyymqawg = 302; if ($kqagasmwymmuiksq === Setting::wceagiqwmmkosoqc) { $qeswwaqqsyymqawg = 350; } echo $this->iuygowkemiiwqmiw('login', [Constants::qomookamaskuoswk => $qeswwaqqsyymqawg]); } public function ygyuikekoaqceoao() { $sogksuscggsicmac = $this->gmcyoyosemugmkgg(Constants::COMMENT, true); $uamcoiueqaamsqma = $sogksuscggsicmac[Constants::eoskkkieowogacws] ?? ''; if (!($sogksuscggsicmac[Constants::imqkacyywmmamsqm] ?? false)) { $uamcoiueqaamsqma = $this->iwcyqwuymeoesqem($uamcoiueqaamsqma); if ($this->caokeucsksukesyo()->owicscwgeuqcqaig()->mcgoysmkqsqooceq()) { throw new Exception($uamcoiueqaamsqma); } wp_die(sprintf('%s:&nbsp;%s<br/>&nbsp;%s', $this->caokeucsksukesyo()->wgqqgewcmcemoewo()->ciuuiyckmsygceis(__('Error', PR__MDL__SECURITY)), $uamcoiueqaamsqma, __('Click the BACK button on your browser and try again.', PR__MDL__SECURITY))); } } public function lgkgiiwswqkaiiwy() { if (!$this->kiysyykiwyiaqwou()) { $kqagasmwymmuiksq = $this->aaiqmckgssqmwqyc(); echo $this->wgqqgewcmcemoewo(['container_attrs' => ['class' => $kqagasmwymmuiksq === Setting::wceagiqwmmkosoqc ? 'col-12 form-group' : '']]); } } public function awcuoygkakueaycw() { $ckugsqsomwywoois = debug_backtrace(); $awcuoygkakueaycw = false; foreach ($ckugsqsomwywoois as $smgswawakqcsecka) { if (isset($smgswawakqcsecka[Constants::kekgqaemqessuwmq]) && str_contains($smgswawakqcsecka[Constants::kekgqaemqessuwmq], 'woocommerce')) { $awcuoygkakueaycw = true; break; } } return $awcuoygkakueaycw; } public function ykimweskqqucieug($mkucggyaiaukqoce) { if (!isset($mkucggyaiaukqoce->errors['empty_username']) && !isset($mkucggyaiaukqoce->errors['empty_password']) && !$this->awcuoygkakueaycw() && !is_wp_error($mkucggyaiaukqoce)) { $sogksuscggsicmac = $this->gmcyoyosemugmkgg(Setting::aqoquuuwysagakqo, true); if (!$sogksuscggsicmac[Constants::imqkacyywmmamsqm]) { if ($sogksuscggsicmac['reason'] === self::qceqiuuakwieousk) { wp_clear_auth_cookie(); } $ueeagokqmgisgauy = $this->caokeucsksukesyo()->euekiyuksecoccus()->gosmqcmmomkqwmis(__('Authentication failed.', PR__MDL__SECURITY), 401); $qwyqkkmyiwogekci = $sogksuscggsicmac[Constants::iwyueouqaqegmcas]->errors; foreach ($qwyqkkmyiwogekci as $ymacoouqwcqwwagu => $wumguikkgaigkoee) { foreach ($wumguikkgaigkoee as $uamcoiueqaamsqma) { $ueeagokqmgisgauy->add($ymacoouqwcqwwagu, $uamcoiueqaamsqma); } } $mkucggyaiaukqoce = $ueeagokqmgisgauy; } } return $mkucggyaiaukqoce; } public function aweogmegeigqoagk($ueeagokqmgisgauy) { if ($ueeagokqmgisgauy instanceof WP_Error) { if ($uamcoiueqaamsqma = $ueeagokqmgisgauy->get_error_message('recaptcha_error')) { echo $this->caokeucsksukesyo()->kugiyqykwaskawsc()->oockkqiqsssakuug([Constants::squoamkioomemiyi => Constants::imkacwmiuiykyuim, Constants::ssmskyqgcmeiayco => $uamcoiueqaamsqma]); } if ($uamcoiueqaamsqma = $ueeagokqmgisgauy->get_error_message('lmttmpts_error')) { echo $this->caokeucsksukesyo()->kugiyqykwaskawsc()->oockkqiqsssakuug([Constants::squoamkioomemiyi => Constants::imkacwmiuiykyuim, Constants::ssmskyqgcmeiayco => $uamcoiueqaamsqma]); } } echo $this->wgqqgewcmcemoewo(); } public function usqaeseikciwyyco($aqykuigiuwmmcieu) { global $current_user; if (!$current_user->data->ID && (!$this->uwkmaywceaaaigwo()->owicscwgeuqcqaig()->goecwaaykqoaaagg() || $this->caokeucsksukesyo()->owicscwgeuqcqaig()->mcgoysmkqsqooceq())) { $sogksuscggsicmac = $this->gmcyoyosemugmkgg(Setting::aqoquuuwysagakqo, true); if (!$sogksuscggsicmac[Constants::imqkacyywmmamsqm]) { $aqykuigiuwmmcieu[Constants::iwyueouqaqegmcas] = $sogksuscggsicmac[Constants::iwyueouqaqegmcas]; } } return $aqykuigiuwmmcieu; } public function iaaimyouoqioysei($cuakwceieagskoaa) { $gioggcykgoikcwiy = $this->caokeucsksukesyo()->giiecckwoyiawoyy()->ayueggmoqeeukqmq(self::agkkoeoygiqmweai); if (!$gioggcykgoikcwiy || !$this->awcuoygkakueaycw()) { $sogksuscggsicmac = $this->gmcyoyosemugmkgg(Setting::aqoquuuwysagakqo, true); if (!$sogksuscggsicmac[Constants::imqkacyywmmamsqm]) { $cuakwceieagskoaa = $sogksuscggsicmac[Constants::iwyueouqaqegmcas]; } } return $cuakwceieagskoaa; } public function msyeyoqmgswmkmqq($cuakwceieagskoaa) { if (!$this->awcuoygkakueaycw()) { $sogksuscggsicmac = $this->gmcyoyosemugmkgg(Setting::aqoquuuwysagakqo, true); if (!$sogksuscggsicmac[Constants::imqkacyywmmamsqm]) { $cuakwceieagskoaa = $sogksuscggsicmac[Constants::iwyueouqaqegmcas]; } $_POST[self::agkkoeoygiqmweai] = true; } return $cuakwceieagskoaa; } public function oamiywquskeykcig($eaoumsseceiowgsk, $cwwowqyuwccuykom) { } public function aowomwcucgqqciow($gioggcykgoikcwiy, $eaoumsseceiowgsk) { $sogksuscggsicmac = $this->ueeoemyowygoykkc($gioggcykgoikcwiy[Constants::imqkacyywmmamsqm] ?? '', $eaoumsseceiowgsk); if (true !== $sogksuscggsicmac) { $gioggcykgoikcwiy[Constants::imqkacyywmmamsqm] = false; if (Constants::yuguikokwoymmqem !== $eaoumsseceiowgsk) { if (is_wp_error($sogksuscggsicmac)) { $gioggcykgoikcwiy[Constants::iwyueouqaqegmcas]->add('lmttmpts_error', $sogksuscggsicmac->get_error_message()); } else { if (is_string($sogksuscggsicmac)) { $gioggcykgoikcwiy[Constants::iwyueouqaqegmcas]->add('lmttmpts_error', $sogksuscggsicmac); } } } } else { if ('contact_form' === $eaoumsseceiowgsk) { $gioggcykgoikcwiy[Constants::imqkacyywmmamsqm] = true; } } return $gioggcykgoikcwiy; } public function oaeowaoiiyqagqoc($okkgmqycykeiksgm = []) { if (!is_array($okkgmqycykeiksgm)) { $okkgmqycykeiksgm = []; } $okkgmqycykeiksgm['recaptcha'] = [Constants::NAME => __('reCaptcha', PR__MDL__SECURITY), 'forms' => []]; $aowigioookasioco = $this->akmqwuowiiwcksec(); foreach ($aowigioookasioco as $ymqmyyeuycgmigyo => $meqocwsecsywiiqs) { $okkgmqycykeiksgm['recaptcha']['forms']["{$ymqmyyeuycgmigyo}_recaptcha_check"] = $meqocwsecsywiiqs; } return $okkgmqycykeiksgm; } public function owykscaeskyaywow(array $ywmkwiwkosakssii = []) { echo $this->aoomuuaiueuouuuu($ywmkwiwkosakssii); } public function wgqqgewcmcemoewo($ewgwqamkygiqaawc = '', array $ywmkwiwkosakssii = []) : string { return $this->aoomuuaiueuouuuu($ywmkwiwkosakssii); } public function memkcksqcswuuucs($eaoumsseceiowgsk = Constants::ioomakeyqiqowgmk, $cwwowqyuwccuykom = false) : string { $iswcokucwmiosiaq = ''; $ussowkigumoaoowo = $this->gmcyoyosemugmkgg($eaoumsseceiowgsk, $cwwowqyuwccuykom); if (isset($ussowkigumoaoowo[Constants::imqkacyywmmamsqm]) && !$ussowkigumoaoowo[Constants::imqkacyywmmamsqm]) { $ueeagokqmgisgauy = $this->caokeucsksukesyo()->euekiyuksecoccus()->ywgmqwueaugywcwi($ussowkigumoaoowo[Constants::iwyueouqaqegmcas] ?? []); if ($ueeagokqmgisgauy) { $iswcokucwmiosiaq = $this->caokeucsksukesyo()->kugiyqykwaskawsc()->oockkqiqsssakuug([Constants::squoamkioomemiyi => Constants::wyaqwomqwwaoiwas, Constants::ssmskyqgcmeiayco => implode('<br>', $ueeagokqmgisgauy)]); } } return $iswcokucwmiosiaq; } public function ueeoemyowygoykkc($sogksuscggsicmac, string $aaokuekaimigoyue = Constants::yuguikokwoymmqem) { if ($this->uwkmaywceaaaigwo()->mmsykuomogaqoaye()->caugyysismkkekgw('lmtttmpts_check_ip')) { $okkgmqycykeiksgm = $this->akmqwuowiiwcksec(); $la_form_slug = "{$aaokuekaimigoyue}_recaptcha_check"; if ($sogksuscggsicmac) { $sogksuscggsicmac = $this->sscegwueamckwmcy('lmtttmpts_check_ip', $sogksuscggsicmac); $this->cqscqicucmeamkyq('lmtttmpts_form_success', $la_form_slug, $this->caokeucsksukesyo()->issssuygyewuaswa()->mmscegoieayuaguo(), ['form_name' => $okkgmqycykeiksgm[$aaokuekaimigoyue]['form_name']]); } else { $form_data = ['form_name' => $okkgmqycykeiksgm[$aaokuekaimigoyue]['form_name']]; $la_error = $this->sscegwueamckwmcy('lmtttmpts_form_fail', $la_form_slug, '', $form_data); if (!empty($la_error) && $la_form_slug != $la_error) { if (is_wp_error($sogksuscggsicmac)) { $sogksuscggsicmac->add("gglcptch_error_lmttmpts", $la_error); } else { if (is_string($sogksuscggsicmac)) { $sogksuscggsicmac .= '<br />' . $la_error; } else { $sogksuscggsicmac = $la_error; } } } } } return $sogksuscggsicmac; } private function sgkykkuemwykseyo() : string { $kqagasmwymmuiksq = $this->aaiqmckgssqmwqyc(); $mokawwccycoiqeka = $this->weysguygiseoukqw(Setting::ikywmkamoywkuaeq, false) ? 'recaptcha.net' : 'google.com'; $souaaeyyeooiwosu = "https://www.{$mokawwccycoiqeka}/recaptcha/api"; $locale = 'en'; if ($this->caokeucsksukesyo()->eiwcuqigayigimak()->miqkyauycmkywoka()) { $locale = 'fa'; } if (in_array($kqagasmwymmuiksq, [Setting::wceagiqwmmkosoqc, Setting::INVISIBLE], true)) { $souaaeyyeooiwosu .= ".js"; $souaaeyyeooiwosu = add_query_arg(['onload' => 'recaptchaOnloadCallback', 'render' => 'explicit', 'hl' => $locale], $souaaeyyeooiwosu); } else { if ($kqagasmwymmuiksq === Setting::VERSION_3) { $scyaqoycmsomyysc = $this->weysguygiseoukqw(Setting::vagagcuyyeiqoikg); $souaaeyyeooiwosu .= ".js"; $souaaeyyeooiwosu = add_query_arg(['render' => $scyaqoycmsomyysc, 'lang' => $locale], $souaaeyyeooiwosu); } else { $souaaeyyeooiwosu .= '/js/recaptcha_ajax.js'; } } return $souaaeyyeooiwosu; } }
